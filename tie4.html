<!DOCTYPE html>
<html lang="en">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="refresh" content="0; url=tie.html?id=4" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Redirecting…</title>
  <link rel="icon" href="images/favicon-logo.svg" type="image/svg+xml">
  <script>(function(){var t='tie.html?id=4';try{location.replace(t)}catch(e){location.href=t}})();</script>
  <link rel="canonical" href="tie.html?id=4" />
</head>
<body>
  <p>Redirecting to the updated tie page… If you are not redirected automatically, <a href="tie.html?id=4">click here</a>.</p>
</body>
</html>
      }
      .floating-whatsapp i {
        font-size: 1.3em;
      }
    }
  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>Silk Tie 4 - Rimmer's Collection</title>
  <link rel="icon" href="images/favicon-logo.svg" type="image/svg+xml">
  <link rel="stylesheet" href="css/style.css?v=20250925-4">
  <script>
    (function(){
      try {
        var ua = navigator.userAgent || '';
        var iPadOSDesktop = (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        var isiOS = /iPad|iPhone|iPod/.test(ua) || iPadOSDesktop;
        if (isiOS) { document.documentElement.classList.add('is-ios'); }
      } catch(e) {}
    })();
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="tie-page">
  <!-- Floating WhatsApp for desktop; hidden on tablet/phone by CSS -->
  <a href="https://wa.me/972535455468" target="_blank" class="floating-whatsapp" aria-label="Chat on WhatsApp">
    <i class="fab fa-whatsapp"></i>
  </a>
  <header class="shrunk">
    <div style="display: flex; align-items: center; justify-content: center; gap: 24px;">
      <div class="header-flex">
        <div class="header-left">
          <a href="contact.html" style="background: none; color: var(--brand-blue); text-decoration: underline; font-weight: bold; font-size: 1.1em; border: none; padding: 0; border-radius: 0;">Contact</a>
        </div>
        <div class="header-center">
          <a href="index.html"><img src="images/logo.svg" alt="Rimmer's Logo" class="logo"></a>
        </div>
        <div class="header-right">
          <button class="menu-toggle" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-menu">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </button>
        </div>
      </div>
    </div>
    <nav id="mobile-menu" class="mobile-menu" role="menu">
      <a href="index.html" role="menuitem">Home</a>
      <a href="contact.html" role="menuitem">Contact</a>
    </nav>
  </header>
  
  <script>
    // Mobile hamburger toggle for tie pages
    (function() {
      var toggle = document.querySelector('.menu-toggle');
      var menu = document.getElementById('mobile-menu');
      if (!toggle || !menu) return;

      function closeMenu() {
        menu.classList.remove('open');
        toggle.classList.remove('open');
        toggle.setAttribute('aria-expanded', 'false');
        try { toggle.blur(); } catch (e) {}
      }
      function openMenu() {
        menu.classList.add('open');
        toggle.classList.add('open');
        toggle.setAttribute('aria-expanded', 'true');
      }
      function toggleMenu() {
        if (menu.classList.contains('open')) closeMenu(); else openMenu();
      }
      toggle.addEventListener('click', function(e) {
        e.stopPropagation();
        toggleMenu();
      });
      document.addEventListener('click', function(e) {
        if (!menu.contains(e.target) && !toggle.contains(e.target)) {
          closeMenu();
        }
      });
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') closeMenu();
      });
    })();
  </script>
  
  <div class="tie-details">
    <h2>R4 - Dark Grey and Blue Stars Tie - Satin Silk</h2>
    
    <div class="tie-carousel">
      <div class="carousel-container">
        <div class="carousel-track" id="carousel-track">
          <div class="carousel-slide">
            <img src="images/satin-darkblue.jpg" alt="Dark Grey and Blue Stars Tie - Front View">
          </div>
          <div class="carousel-slide">
            <img src="images/satin-darkblue-back.webp" alt="Dark Grey and Blue Stars Tie - Back View">
          </div>
          <div class="carousel-slide">
            <img src="images/satin-darkblue-tongue.webp" alt="Dark Grey and Blue Stars Tie - Detail View">
          </div>
          <div class="carousel-slide">
            <img src="images/satin-darkblue-body.webp" alt="Dark Grey and Blue Stars Tie - Full Body">
          </div>
        </div>
        
        <button class="carousel-nav prev" onclick="changeSlide(-1)">‹</button>
        <button class="carousel-nav next" onclick="changeSlide(1)">›</button>
      </div>
      
      <div class="carousel-indicators">
        <button class="carousel-dot active" onclick="currentSlide(1)"></button>
        <button class="carousel-dot" onclick="currentSlide(2)"></button>
        <button class="carousel-dot" onclick="currentSlide(3)"></button>
        <button class="carousel-dot" onclick="currentSlide(4)"></button>
      </div>
    </div>
    
    <!-- Back to main page + WhatsApp inline on tablet/phone -->
    <p class="back-actions">
      <a href="index.html" class="back-link-inline">← Back to Collection</a>
      <a href="https://wa.me/972535455468" target="_blank" class="whatsapp-inline" aria-label="Chat on WhatsApp">
        <i class="fab fa-whatsapp"></i>
      </a>
    </p>
  </div>

  <script>
    // Image Carousel functionality (pointer events + live dragging)
    let currentSlideIndex = 0;
    const slides = document.querySelectorAll('.carousel-slide');
    const dots = document.querySelectorAll('.carousel-dot');
    const track = document.getElementById('carousel-track');
    let isAnimating = false;
    // Detect iOS Safari specifically (exclude Chrome/Firefox/Edge on iOS)
    function isIOSSafari(){
      var ua = navigator.userAgent || '';
      var iPadOSDesktop = (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
      var isiOS = /iPad|iPhone|iPod/.test(ua) || iPadOSDesktop;
      var nonSafari = /CriOS|FxiOS|EdgiOS/.test(ua);
      return !!(isiOS && !nonSafari);
    }

  function getContainerWidth(){ const container=track.parentElement||track; return (container&&container.clientWidth)?container.clientWidth:1; }
  function setTransformByIndex(index){ const w=getContainerWidth(); const px=-(index*w); track.style.transform=`translateX(${px}px)`; }
    function updateDots() { dots.forEach((dot, i) => dot.classList.toggle('active', i === currentSlideIndex)); }
    function updateCarousel() { setTransformByIndex(currentSlideIndex); updateDots(); }
  function gotoSlide(index){ if(isAnimating) return; const total=slides.length; if(!total) return; if(index>=total) index=0; if(index<0) index=total-1; isAnimating=true; track.style.transition='transform 300ms ease'; currentSlideIndex=index; setTransformByIndex(currentSlideIndex); updateDots(); if(isIOSSafari()) scheduleUnlockFallback(); }
  // iOS Safari: add fallback unlock and vendor event
  let unlockTimer=null; function clearUnlockTimer(){ if(unlockTimer){ clearTimeout(unlockTimer); unlockTimer=null; } }
  function scheduleUnlockFallback(){ clearUnlockTimer(); unlockTimer=setTimeout(function(){ isAnimating=false; }, 450); }
  track.addEventListener('transitionend', (ev)=>{ if(ev.propertyName==='transform'){ isAnimating=false; clearUnlockTimer(); } });
  track.addEventListener('webkitTransitionEnd', (ev)=>{ if(ev.propertyName==='transform'){ isAnimating=false; clearUnlockTimer(); } });
    function changeSlide(direction){ gotoSlide(currentSlideIndex + direction); }
    function currentSlide(index){ gotoSlide(index - 1); }

    // Pointer events with touch fallback
    let pointerId=null, startX=0, deltaX=0, dragging=false; const SWIPE_THRESHOLD=0.18; const EDGE_RESISTANCE=0.35;
    function onPointerDown(e){ if(isAnimating) return; dragging=true; deltaX=0; pointerId=e.pointerId; startX=e.clientX; track.style.transition='none'; track.setPointerCapture && track.setPointerCapture(pointerId); track.style.willChange='transform'; }
  function onPointerMove(e){ if(!dragging) return; const x=e.clientX; deltaX=x-startX; const w=getContainerWidth(); let dx=deltaX; if((currentSlideIndex===0 && dx>0)||(currentSlideIndex===slides.length-1 && dx<0)) dx*=EDGE_RESISTANCE; const base=-(currentSlideIndex*w); track.style.transform=`translateX(${base+dx}px)`; }
  function onPointerUpOrCancel(){ if(!dragging) return; dragging=false; track.style.willChange='auto'; const w=getContainerWidth(); const traveled=Math.abs(deltaX)/w; track.style.transition='transform 300ms ease'; if(traveled>SWIPE_THRESHOLD){ const dir=deltaX<0?1:-1; gotoSlide(currentSlideIndex+dir);} else { setTransformByIndex(currentSlideIndex);} pointerId=null; deltaX=0; }
  // Detect any iOS device (Safari or Chrome on iOS) to force touch fallback
  function isIOSDevice(){ var ua=navigator.userAgent||''; var iOS=/iPad|iPhone|iPod/.test(ua); var iPadOSDesktopMode=(navigator.platform==='MacIntel' && navigator.maxTouchPoints>1); return !!(iOS||iPadOSDesktopMode); }
  // Disable swipe on desktop; use arrows only
  const isDesktop = window.matchMedia && window.matchMedia('(min-width: 1024px)').matches;
  if(!isDesktop && window.PointerEvent && !isIOSDevice()){ track.addEventListener('pointerdown', onPointerDown); track.addEventListener('pointermove', onPointerMove); track.addEventListener('pointerup', onPointerUpOrCancel); track.addEventListener('pointercancel', onPointerUpOrCancel); }
    else {
      let touchStartX=0,lastX=0,locked=false; const LOCK_THRESHOLD=8; 
      track.addEventListener('touchstart',(e)=>{ if(isAnimating) return; const t=e.touches[0]; touchStartX=t.clientX; lastX=touchStartX; dragging=true; locked=false; track.style.transition='none'; track.style.willChange='transform'; },{passive:true});
  track.addEventListener('touchmove',(e)=>{ if(!dragging) return; const t=e.touches[0]; const x=t.clientX; const dx=x-touchStartX; lastX=x; if(!locked && Math.abs(dx)>LOCK_THRESHOLD && e.cancelable){ e.preventDefault(); locked=true; } const w=getContainerWidth(); let dragX=dx; if((currentSlideIndex===0 && dragX>0)||(currentSlideIndex===slides.length-1 && dragX<0)) dragX*=EDGE_RESISTANCE; const base=-(currentSlideIndex*w); track.style.transform=`translateX(${base+dragX}px)`; },{passive:false});
  track.addEventListener('touchend',(e)=>{ if(!dragging) return; dragging=false; track.style.willChange='auto'; const endX=(e.changedTouches&&e.changedTouches[0]?e.changedTouches[0].clientX:lastX); const w=getContainerWidth(); const traveled=Math.abs(endX-touchStartX)/w; track.style.transition='transform 300ms ease'; if(traveled>0.18){ const dir=(endX-touchStartX)<0?1:-1; gotoSlide(currentSlideIndex+dir);} else { setTransformByIndex(currentSlideIndex);} },{passive:true});
      track.addEventListener('touchcancel',()=>{ dragging=false; track.style.willChange='auto'; track.style.transition='transform 300ms ease'; setTransformByIndex(currentSlideIndex); },{passive:true});
    }

    // Keyboard navigation
    document.addEventListener('keydown',(e)=>{ if(e.key==='ArrowLeft') changeSlide(-1); else if(e.key==='ArrowRight') changeSlide(1); });
    
    // Re-sync transform after resize/orientation changes (pixel-based transforms)
    function debounce(fn, delay){ let t; return function(){ const ctx=this, args=arguments; clearTimeout(t); t=setTimeout(function(){ fn.apply(ctx,args); }, delay); } }
    function syncTransformToSize(){ const prev=track.style.transition; track.style.transition='none'; setTransformByIndex(currentSlideIndex); void track.offsetWidth; track.style.transition=prev; }
    window.addEventListener('resize', debounce(syncTransformToSize, 120));
    window.addEventListener('orientationchange', debounce(syncTransformToSize, 120));
  </script>
</body>
</html>
