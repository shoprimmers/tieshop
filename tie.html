<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>Silk Tie - Rimmer's Collection</title>
  <link rel="stylesheet" href="css/style.css?v=20250914-3">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="tie-page tie-page-body">
  <a href="#main" class="skip-link">Skip to content</a>
  <!-- Floating WhatsApp for desktop; hidden on tablet/phone by CSS -->
  <a href="https://wa.me/972535455468" target="_blank" rel="noopener" class="floating-whatsapp" aria-label="Chat on WhatsApp">
    <i class="fab fa-whatsapp"></i>
  </a>

  <header class="shrunk" role="banner">
    <div class="header-flex">
      <div class="header-left">
        <a href="contact.html" class="contact-link" style="color: var(--brand-blue); text-decoration: underline; font-weight: bold; font-size: 1.1em; margin-right: 8px; background: none; border: none; padding: 0; border-radius: 0;">Contact</a>
      </div>
      <div class="header-center">
        <a href="index.html"><img src="images/logo.svg" alt="Rimmer's Logo" class="logo"></a>
      </div>
      <div class="header-right">
        <button class="menu-toggle" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-menu">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </button>
      </div>
    </div>
    <nav id="mobile-menu" class="mobile-menu" role="navigation" aria-label="Main menu">
      <a href="contact.html">Contact</a>
    </nav>
  </header>

  <script>
    // Mobile hamburger toggle for tie pages
    (function() {
      var toggle = document.querySelector('.menu-toggle');
      var menu = document.getElementById('mobile-menu');
      if (!toggle || !menu) return;

      function closeMenu() {
        menu.classList.remove('open');
        toggle.classList.remove('open');
        toggle.setAttribute('aria-expanded', 'false');
        try { toggle.blur(); } catch (e) {}
      }
      function openMenu() {
        menu.classList.add('open');
        toggle.classList.add('open');
        toggle.setAttribute('aria-expanded', 'true');
      }
      function toggleMenu() {
        if (menu.classList.contains('open')) closeMenu(); else openMenu();
      }
      toggle.addEventListener('click', function(e) {
        e.stopPropagation();
        toggleMenu();
      });
      document.addEventListener('click', function(e) {
        if (!menu.contains(e.target) && !toggle.contains(e.target)) {
          closeMenu();
        }
      });
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') closeMenu();
      });
    })();
  </script>

  <main id="main">
  <h1 class="sr-only">Tie details</h1>
  <div class="tie-details">
    <h2 id="tie-title">Loading...</h2>

    <div class="tie-carousel" role="region" aria-roledescription="carousel" aria-label="Tie image gallery">
      <div class="carousel-container">
        <div class="carousel-track" id="carousel-track">
          <!-- Slides injected by JS -->
        </div>
        <!-- Smartphone-only WhatsApp overlay (positioned bottom-left over the image) -->
        <a href="https://wa.me/972535455468" target="_blank" rel="noopener" class="whatsapp-overlay" aria-label="Chat on WhatsApp">
          <i class="fab fa-whatsapp"></i>
        </a>
        <button class="carousel-nav prev" onclick="changeSlide(-1)" aria-label="Previous image" aria-controls="carousel-track">‹</button>
        <button class="carousel-nav next" onclick="changeSlide(1)" aria-label="Next image" aria-controls="carousel-track">›</button>
      </div>
      <div class="carousel-indicators" id="carousel-indicators" role="tablist" aria-label="Select image">
          <!-- Dots injected by JS -->
      </div>
        <p id="carousel-status" class="sr-only" aria-live="polite"></p>
    </div>

    <p class="back-actions">
      <a href="index.html" class="back-link-inline">← Back to Collection</a>
      <a href="https://wa.me/972535455468" target="_blank" rel="noopener" class="whatsapp-inline" aria-label="Chat on WhatsApp">
        <i class="fab fa-whatsapp"></i>
      </a>
    </p>
  </div>
  </main>

  <script>
    // Tiny data-driven tie page: reads ?id=NUMBER and loads images/title from data/ties.json
    const params = new URLSearchParams(location.search);
    const id = params.get('id');

    function renderTie(tie) {
      const titleEl = document.getElementById('tie-title');
      const track = document.getElementById('carousel-track');
      const indicators = document.getElementById('carousel-indicators');
      titleEl.textContent = tie.title;
      track.innerHTML = '';
      indicators.innerHTML = '';
      tie.images.forEach((img, idx) => {
        const slide = document.createElement('div');
        slide.className = 'carousel-slide';
          slide.setAttribute('role', 'group');
          slide.setAttribute('aria-roledescription', 'slide');
          slide.setAttribute('aria-label', `Image ${idx + 1} of ${tie.images.length}`);
          if (idx !== 0) slide.setAttribute('aria-hidden', 'true');
  const image = document.createElement('img');
  image.src = img.src;
  image.loading = (idx === 0 ? 'eager' : 'lazy');
  image.decoding = 'async';
        image.alt = img.alt || tie.title + ' - Image ' + (idx + 1);
        slide.appendChild(image);
        track.appendChild(slide);
        const dot = document.createElement('button');
          dot.className = 'carousel-dot' + (idx === 0 ? ' active' : '');
          dot.setAttribute('role', 'tab');
          dot.setAttribute('aria-selected', idx === 0 ? 'true' : 'false');
          dot.setAttribute('aria-controls', 'carousel-track');
          dot.setAttribute('title', `Show image ${idx + 1}`);
          dot.onclick = () => currentSlide(idx + 1);
        indicators.appendChild(dot);
      });
      // Reset carousel state
      currentSlideIndex = 0;
      slides = document.querySelectorAll('.carousel-slide');
      dots = document.querySelectorAll('.carousel-dot');
      updateCarousel();
    }

    fetch('data/ties.json')
      .then(r => r.json())
      .then(data => {
        const tie = data.ties[id];
        if (!tie) throw new Error('Tie not found: ' + id);
        renderTie(tie);
        try { document.title = tie.title + " | Rimmer's"; } catch(e) {}
      })
      .catch(err => {
        document.getElementById('tie-title').textContent = 'Tie not found';
        console.error(err);
      });

    // Carousel logic (same as other pages)
    let currentSlideIndex = 0;
    let slides = [];
    let dots = [];
    const track = document.getElementById('carousel-track');

    function updateCarousel() {
      track.style.transform = `translateX(-${currentSlideIndex * 100}%)`;
        const status = document.getElementById('carousel-status');
        dots.forEach((dot, index) => {
          const isActive = index === currentSlideIndex;
          dot.classList.toggle('active', isActive);
          dot.setAttribute('aria-selected', isActive ? 'true' : 'false');
          if (slides[index]) {
            slides[index].setAttribute('aria-hidden', isActive ? 'false' : 'true');
          }
        });
        if (status) {
          const total = slides.length;
          const pos = currentSlideIndex + 1;
          status.textContent = `Image ${pos} of ${total}`;
        }
    }

    function changeSlide(direction) {
      currentSlideIndex += direction;
      if (currentSlideIndex >= slides.length) currentSlideIndex = 0;
      else if (currentSlideIndex < 0) currentSlideIndex = slides.length - 1;
      updateCarousel();
    }

    function currentSlide(index) {
      currentSlideIndex = index - 1;
      updateCarousel();
    }

    // Touch/swipe support
    let startX = 0;
    let isDragging = false;
    track.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; isDragging = true; });
    track.addEventListener('touchmove', (e) => { if (!isDragging) return; e.preventDefault(); });
    track.addEventListener('touchend', (e) => {
      if (!isDragging) return; isDragging = false;
      const endX = e.changedTouches[0].clientX; const diffX = startX - endX;
      if (Math.abs(diffX) > 50) { changeSlide(diffX > 0 ? 1 : -1); }
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') changeSlide(-1);
      else if (e.key === 'ArrowRight') changeSlide(1);
    });
  </script>
  <footer>
    <p>&copy; 2025 Rimmer’s Luxury Ties · <a href="accessibility.html">Accessibility</a></p>
  </footer>
</body>
</html>
